services:
  vsite.app.manager:
    class: Drupal\vsite\Plugin\AppManager
    parent: default_plugin_manager
  hierarchical.storage:
    class: Drupal\vsite\Config\HierarchicalStorage
    public: false
    decorates: config.storage
    decoration_priority: 4
    arguments: ['@hierarchical.storage.inner']
  vsite.storage:
    class: Drupal\vsite\Config\VsiteStorageDefinition
    arguments: ['@hierarchical.storage']
    tags:
      - { name: event_subscriber }
  vsite.outboundpathprocessor:
    class: Drupal\vsite\PathProcessor\VsiteOutboundPathProcessor
    arguments:
      - '@vsite.context_manager'
    tags:
      - { name: path_processor_outbound, priority: 299 }
  vsite.context_manager:
    class: Drupal\vsite\Plugin\VsiteContextManager
    arguments:
      - '@event_dispatcher'
  vsite.path_activator:
    class: Drupal\vsite\Plugin\VsitePathActivator
    arguments:
      - '@vsite.context_manager'
      - '@entity_type.manager'
    tags:
      - { name: event_subscriber }
  vsite.alias_storage:
    class: Drupal\vsite\Path\VsiteAliasStorage
    decorates: path.alias_storage
    decoration_priority: 4
    arguments:
      - '@vsite.alias_storage.inner'
      - '@purl.modifier_index'
      - '@entity_type.manager'
      - '@vsite.context_manager'